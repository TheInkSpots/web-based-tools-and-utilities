<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DevUtils - Regex Tester</title>

    <style>
        /* --- 1. THEME VARIABLES --- */
        :root {
            --bg-dark: #121212;
            --bg-panel: #1e1e1e;
            --text-main: #ffffff;
            --text-muted: #a0a0a0;
            --border: #333333;
            
            --jwt-pink: #fb015b;
            --jwt-purple: #d63aff;
            --jwt-blue: #00b9f1;
            --success: #27ae60;
            --highlight-bg: rgba(214, 58, 255, 0.4);
            --match-border: 1px solid rgba(214, 58, 255, 0.8);
            
            --input-bg: rgba(0,0,0,0.3);
            --floating-bg: rgba(30, 30, 30, 0.95); /* Slightly transparent panel */
            --shadow: 0 8px 30px rgba(0,0,0,0.5);
            
            --code-font: 'Fira Code', 'Consolas', monospace;
        }

        [data-theme=light] {
            --bg-dark: #f0f2f5;
            --bg-panel: #ffffff;
            --text-main: #333333;
            --text-muted: #666;
            --border: #ddd;
            --input-bg: #f9f9f9;
            --floating-bg: rgba(255, 255, 255, 0.95);
            --shadow: 0 8px 30px rgba(0,0,0,0.1);
            --highlight-bg: rgba(255, 235, 59, 0.5);
            --match-border: 1px solid #fbc02d;
        }

        /* --- 2. RESET & LAYOUT --- */
        * { box-sizing: border-box; outline: 0; }
        body { font-family: 'Roboto', sans-serif; color: var(--text-main); background-color: var(--bg-dark); margin: 0; padding-bottom: 50px; transition: background .3s; }

        /* Header */
        header { display: flex; justify-content: space-between; align-items: center; padding: 15px 30px; background: var(--bg-panel); border-bottom: 1px solid var(--border); }
        .logo { gap: 10px; font-weight: 700; font-size: 1.1rem; display: flex; align-items: center; }
        .logo-icon { width: 32px; height: 32px; background: var(--jwt-pink); border-radius: 4px; display: grid; place-items: center; color: #fff; font-family: var(--code-font); font-weight: bold; }
        .icon-btn { cursor: pointer; opacity: 0.7; font-size: 1.2rem; }
        .icon-btn:hover { opacity: 1; }

        /* --- 3. FLOATING CONTROLS (NEW) --- */
        .sticky-controls-wrapper {
            position: sticky;
            top: 0;
            z-index: 1000;
            background: var(--bg-dark); /* Fallback */
            padding-top: 20px;
            padding-bottom: 20px;
            margin-bottom: 20px;
        }
        
        /* Create a backdrop effect if supported */
        @supports (backdrop-filter: blur(10px)) {
            .sticky-controls-wrapper {
                background: transparent;
                backdrop-filter: blur(10px);
            }
        }

        .floating-panel {
            max-width: 1200px;
            margin: 0 auto;
            background: var(--floating-bg);
            border: 1px solid var(--border);
            border-radius: 8px;
            box-shadow: var(--shadow);
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        /* Control Grid: Side by Side Inputs */
        .control-grid {
            display: flex;
            gap: 20px;
        }
        @media (max-width: 900px) { .control-grid { flex-direction: column; } }

        .control-col { flex: 1; }

        .input-label {
            font-size: 0.75rem; text-transform: uppercase; font-weight: 700; color: var(--text-muted); margin-bottom: 8px; display: block;
        }

        /* Inputs */
        .input-group { position: relative; display: flex; align-items: center; width: 100%; }
        .regex-slashes { color: var(--text-muted); font-size: 1.2rem; font-family: var(--code-font); padding: 0 10px; font-weight: bold; }
        
        .form-control { width: 100%; padding: 12px; border-radius: 4px; border: 1px solid var(--border); background: var(--input-bg); color: var(--text-main); font-family: var(--code-font); font-size: 1rem; transition: border-color 0.2s; }
        .form-control:focus { border-color: var(--jwt-blue); box-shadow: 0 0 0 2px rgba(0, 185, 241, 0.2); }
        
        /* Flags */
        .flags-container { display: flex; gap: 15px; margin-top: 8px; padding-left: 5px; }
        .flag-label { font-size: 0.8rem; color: var(--text-muted); cursor: pointer; display: flex; align-items: center; gap: 5px; font-family: var(--code-font); user-select: none; }
        .flag-label input { accent-color: var(--jwt-pink); }
        .flag-label:hover { color: var(--text-main); }

        /* --- 4. SCROLLABLE WORKSPACE --- */
        .container { max-width: 1200px; margin: 0 auto; padding: 0 20px; display: flex; gap: 30px; flex-direction: column; }
        .workspace { display: flex; gap: 30px; }
        @media (max-width: 900px) { .workspace { flex-direction: column; } }

        .col-left { flex: 1; display: flex; flex-direction: column; gap: 20px; }
        .col-right { flex: 1; display: flex; flex-direction: column; gap: 20px; }

        /* Panels */
        .panel { background: var(--bg-panel); border: 1px solid var(--border); border-radius: 6px; overflow: hidden; display: flex; flex-direction: column; height: 100%; }
        .panel-header { padding: 12px 15px; background: rgba(255,255,255,0.05); border-bottom: 1px solid var(--border); font-size: 0.85rem; font-weight: 700; letter-spacing: 0.5px; text-transform: uppercase; color: var(--text-muted); display: flex; justify-content: space-between; align-items: center; }
        
        textarea.form-control { resize: vertical; min-height: 300px; line-height: 1.6; border: none; border-radius: 0; }
        textarea.form-control:focus { box-shadow: none; }

        /* Output Areas */
        .output-area { 
            padding: 20px; font-family: var(--code-font); line-height: 1.6; 
            white-space: pre-wrap; word-break: break-all; min-height: 300px; 
            color: var(--text-main); 
        }
        
        /* Highlighting Logic */
        mark { background-color: var(--highlight-bg); color: inherit; border-radius: 2px; border-bottom: var(--match-border); padding: 0 2px; }
        
        /* Status */
        .status-pill { font-size: 0.75rem; padding: 2px 8px; border-radius: 4px; font-weight: bold; margin-left: 10px; opacity: 0; transition: opacity 0.2s; }
        .status-pill.show { opacity: 1; }
        .status-error { background: rgba(251, 1, 91, 0.2); color: var(--jwt-pink); }
        .status-valid { background: rgba(39, 174, 96, 0.2); color: var(--success); }

    </style>
</head>
<body>

    <header>
        <div class="logo">
            <div class="logo-icon">.*</div>
            <span>RegexTester</span>
        </div>
        <div class="icon-btn" id="themeToggle">â—‘</div>
    </header>

    <!-- STICKY TOP BAR -->
    <div class="sticky-controls-wrapper">
        <div class="container" style="padding: 0 20px;"> <!-- Match main container padding -->
            <div class="floating-panel">
                <div class="control-grid">
                    
                    <!-- REGEX INPUT -->
                    <div class="control-col" style="flex: 1.5;">
                        <div style="display:flex; justify-content:space-between;">
                            <span class="input-label">Regular Expression</span>
                            <span id="regexStatus" class="status-pill status-valid">Valid</span>
                        </div>
                        <div class="input-group">
                            <span class="regex-slashes">/</span>
                            <input type="text" id="regexInput" class="form-control" placeholder="pattern (e.g. \w+)" value="Hello" oninput="runRegex()">
                            <span class="regex-slashes">/</span>
                            <input type="text" id="regexFlags" class="form-control" style="width: 80px; text-align:center;" placeholder="flags" value="g" oninput="syncFlagsFromText()">
                        </div>
                        <div class="flags-container">
                            <label class="flag-label"><input type="checkbox" id="flagG" checked onchange="syncFlagsFromCheck()"> Global (g)</label>
                            <label class="flag-label"><input type="checkbox" id="flagI" onchange="syncFlagsFromCheck()"> Insensitive (i)</label>
                            <label class="flag-label"><input type="checkbox" id="flagM" onchange="syncFlagsFromCheck()"> Multiline (m)</label>
                        </div>
                    </div>

                    <!-- REPLACEMENT INPUT -->
                    <div class="control-col" style="flex: 1;">
                        <span class="input-label">Replacement Pattern</span>
                        <div class="input-group">
                            <input type="text" id="replaceInput" class="form-control" placeholder="Replacement text" value="HI" oninput="runRegex()">
                        </div>
                        <div style="font-size: 0.75rem; color: var(--text-muted); margin-top: 8px; text-align: right;">
                            Use $1, $2 for groups
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>

    <!-- SCROLLABLE CONTENT -->
    <div class="container">
        <div class="workspace">
            
            <!-- LEFT: TEST STRING -->
            <div class="col-left">
                <div class="panel">
                    <div class="panel-header">Test String</div>
                    <textarea id="testString" class="form-control" placeholder="Paste your text here..." oninput="runRegex()">Hello World! hello universe. HeLLo everyone.</textarea>
                </div>
            </div>

            <!-- RIGHT: OUTPUTS -->
            <div class="col-right">
                
                <!-- Highlights -->
                <div class="panel" style="flex: 1;">
                    <div class="panel-header">
                        <span>Match Highlights</span>
                        <span id="matchCount" style="color: var(--jwt-blue);">0 matches</span>
                    </div>
                    <div id="highlightOutput" class="output-area"></div>
                </div>

                <!-- Substitution -->
                <div class="panel" style="flex: 1;">
                    <div class="panel-header" style="color: var(--success);">Substitution Result</div>
                    <div id="replaceOutput" class="output-area" style="color: var(--jwt-purple);"></div>
                </div>

            </div>
        </div>
    </div>

    <script>
        /* --- 1. UI LOGIC (Flags & Theme) --- */
        function syncFlagsFromCheck() {
            let flags = '';
            if(document.getElementById('flagG').checked) flags += 'g';
            if(document.getElementById('flagI').checked) flags += 'i';
            if(document.getElementById('flagM').checked) flags += 'm';
            document.getElementById('regexFlags').value = flags;
            runRegex();
        }

        function syncFlagsFromText() {
            const val = document.getElementById('regexFlags').value.toLowerCase();
            document.getElementById('flagG').checked = val.includes('g');
            document.getElementById('flagI').checked = val.includes('i');
            document.getElementById('flagM').checked = val.includes('m');
            runRegex();
        }

        /* --- 2. CORE REGEX LOGIC --- */
        function runRegex() {
            const pattern = document.getElementById('regexInput').value;
            const flags = document.getElementById('regexFlags').value;
            const text = document.getElementById('testString').value;
            const replaceText = document.getElementById('replaceInput').value;
            
            const highlightBox = document.getElementById('highlightOutput');
            const replaceBox = document.getElementById('replaceOutput');
            const statusPill = document.getElementById('regexStatus');
            const countLabel = document.getElementById('matchCount');

            highlightBox.innerHTML = escapeHtml(text);
            replaceBox.innerText = text;
            statusPill.className = "status-pill"; // hide
            countLabel.innerText = "0 matches";

            if (!pattern) return;

            try {
                const regex = new RegExp(pattern, flags);
                
                statusPill.innerText = "Valid";
                statusPill.className = "status-pill status-valid show";

                // Replacement
                const replacedResult = text.replace(regex, replaceText);
                replaceBox.innerText = replacedResult;

                // Highlighting
                let matchCount = 0;
                const highlightedHTML = text.replace(regex, (match) => {
                    matchCount++;
                    if(match === "") return ""; 
                    return `<mark>${escapeHtml(match)}</mark>`;
                });

                highlightBox.innerHTML = highlightedHTML;
                
                // Count fix for simple strings vs global
                if(matchCount === 0 && text.match(regex)) {
                     // If 'g' flag missing, replace callback runs once, count is 1
                     // If no match, count is 0
                }
                
                countLabel.innerText = `${matchCount} match${matchCount !== 1 ? 'es' : ''}`;

            } catch (e) {
                statusPill.innerText = "Invalid";
                statusPill.className = "status-pill status-error show";
                highlightBox.innerText = text; // Reset on error
            }
        }

        function escapeHtml(text) {
            if (!text) return "";
            return text
                .replace(/&/g, "&amp;")
                .replace(/</g, "&lt;")
                .replace(/>/g, "&gt;")
                .replace(/"/g, "&quot;")
                .replace(/'/g, "&#039;");
        }

        /* --- 3. THEME TOGGLE --- */
        const themeToggle = document.getElementById('themeToggle');
        if(localStorage.getItem('theme') === 'light') document.body.setAttribute('data-theme', 'light');
        
        themeToggle.addEventListener('click', () => {
            if (document.body.getAttribute('data-theme') === 'light') {
                document.body.removeAttribute('data-theme');
                localStorage.setItem('theme', 'dark');
            } else {
                document.body.setAttribute('data-theme', 'light');
                localStorage.setItem('theme', 'light');
            }
        });

        // Init
        runRegex();

    </script>
</body>
</html>
